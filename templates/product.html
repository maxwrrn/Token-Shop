{% extends "base.html" %}
{% block title %}{{ item.name }} – EcoShop{% endblock %}
{% block content %}
  <div class="product-detail">
    <img src="{{ url_for('static', filename='images/' ~ item.image_filename) }}"
         alt="{{ item.name }}">
    <h1>{{ item.name }}</h1>
    <p>{{ item.description }}</p>
    <p>Price: £{{ "%.2f"|format(item.price) }}</p>
    <p>Impact: {{ item.impact }}</p>
    <a class="btn" href="{{ url_for('add', item_id=item.id) }}">Add to Basket</a>
  </div>

  <h2>Reviews</h2>
  {% if reviews %}
    <ul class="reviews">
      {% for rev in reviews %}
        <li>
          <strong>{{ rev.username }}</strong> rated {{ rev.rating }}/5
          <p>{{ rev.comment }}</p>
        </li>
      {% endfor %}
    </ul>
  {% else %}
    <p>No reviews yet.</p>
  {% endif %}

  {% if session.get('user_id') %}
    <h3>Leave a review</h3>
    <form method="post" action="{{ url_for('review', item_id=item.id) }}">
      <label for="rating">Rating:</label>
      <select name="rating" id="rating" required>
        <option value="">–</option>
        {% for i in range(1,6) %}
          <option value="{{ i }}">{{ i }}</option>
        {% endfor %}
      </select>
      <label for="comment">Comment:</label>
      <textarea name="comment" id="comment" rows="4" required></textarea>
      <button type="submit">Submit Review</button>
    </form>
  {% else %}
    <p><a href="{{ url_for('login') }}">Log in</a> to leave a review.</p>
  {% endif %}
{% endblock %}
